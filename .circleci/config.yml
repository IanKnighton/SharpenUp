version: 2.1
orbs:
  win: circleci/windows@2.2.0
jobs:
  build:
    executor: win/default
    steps:
      - checkout
      - run:
          name: Build
          command: dotnet build SharpenUp/SharpenUp.csproj
      - run:
          name: Install Coveralls
          command: >-
            dotnet tool install -g coveralls.net --version 1.0.0
          shell: bash
      - run:
          name: Test
          command: >-
            dotnet test SharpenUp.Tests/SharpenUp.Tests.csproj --logger "junit;LogFileName=xunit/results.xml" /p:CollectCoverage=true /p:CoverletOutput=TestResults/ /p:CoverletOutputFormat=opencover
      - store_test_results:
          path: SharpenUp.Tests/TestResults
      - run:
          name: Upload to Coveralls
          command: >-
            csmacnz.Coveralls --opencover -i SharpenUp.Tests/TestResults/coverage.opencover.xml --useRelativePaths --commitId $env:CIRCLE_SHA1 --commitBranch $env:CIRCLE_BRANCH --commitAuthor $env:CIRCLE_USERNAME --commitEmail "ian@knighton.dev" --commitMessage "FAKE MESSAGE" --jobId $env:CIRCLE_BUILD_NUM
